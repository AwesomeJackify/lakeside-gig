---
import { Icon } from "astro-icon/components";

import Layout from "../layouts/Layout.astro";
import config from "../data/config.json";

import { createClient } from "../utils";
import getCollectionByIdQuery from "../queries/getCollectionByIdQuery";
import { Image } from "astro:assets";

// get the collection that is shown on the home page
const { data } = await createClient(
  import.meta.env.SHOPIFY_PUBLIC_ACCESS_TOKEN
).request(getCollectionByIdQuery, {
  variables: {
    id: "gid://shopify/Collection/271423144007",
  },
});

// parse the home page collection data
const homePageProducts = data.collection.products.edges.map((product: any) => {
  return {
    id: product.node.id,
    title: product.node.title,
    handle: product.node.handle,
    imageUrl: product.node.featuredImage.url,
    variants: product.node.variants.edges.map((variant: any) => {
      return {
        id: variant.node.id,
        title: variant.node.title,
      };
    }),
  };
});
---

<Layout title={config.businessName} description={config.description}>
  <div class="grid grid-cols-2">
    {
      homePageProducts.map((product: any) => (
        <a href={`/shop/${product.handle}`} class="flex flex-col">
          <img
            src={product.imageUrl}
            alt={product.title}
            class="h-full w-full object-contain"
          />
        </a>
      ))
    }
  </div>
</Layout>
